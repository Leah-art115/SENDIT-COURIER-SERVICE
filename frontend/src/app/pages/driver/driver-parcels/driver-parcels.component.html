<app-driver-navbar></app-driver-navbar>

<div class="container">
  <h2>My Parcels</h2>

  <div class="filter-bar">
    <input
      type="text"
      placeholder="Filter by sender name"
      [(ngModel)]="filterName"
      (ngModelChange)="filteredParcels" />
    <select [(ngModel)]="filterStatus" (ngModelChange)="filteredParcels">
      <option value="">All Statuses</option>
      <option value="PENDING">Pending</option>
      <option value="ASSIGNED">Assigned</option>
      <option value="PICKED_UP_BY_DRIVER">Picked Up</option>
      <option value="IN_TRANSIT">In Transit</option>
      <option value="DELIVERED">Delivered</option>
      <option value="CANCELLED">Cancelled</option>
    </select>
    <select [(ngModel)]="filterMode" (ngModelChange)="filteredParcels">
      <option value="">All Modes</option>
      <option value="STANDARD">Standard</option>
      <option value="EXPRESS">Express</option>
    </select>
    <select [(ngModel)]="filterType" (ngModelChange)="filteredParcels">
      <option value="">All Types</option>
      <option value="BOXED_PACKAGE">Boxed Package</option>
      <option value="ENVELOPE">Envelope</option>
      <option value="BAG">Bag</option>
      <option value="SUITCASE">Suitcase</option>
    </select>
    <input type="date" [(ngModel)]="filterFromDate" (ngModelChange)="filteredParcels" />
    <input type="date" [(ngModel)]="filterToDate" (ngModelChange)="filteredParcels" />
  </div>

  <!-- Empty State Message -->
<div class="empty-state" *ngIf="filteredParcels.length === 0">
  <div class="empty-state-content">
    <div class="empty-icon">
      ðŸ“¦
    </div>
    <h2>No Packages Yet</h2>
    <p>You don't have any packages at the moment. Your packages will appear here once they're available.</p>
  </div>
</div>

  <div class="parcel-cards">
    <div *ngFor="let parcel of filteredParcels"
         class="card"
         [ngClass]="{'completed-parcel': isParcelCompleted(parcel)}"
         tabindex="0">
      <div class="card-header">
        <h3>Parcel   {{ parcel.trackingId }}</h3>
        <span class="status-badge"
              [ngClass]="{
                'status-pending': parcel.status === 'PENDING',
                'status-assigned': parcel.status === 'ASSIGNED',
                'status-picked-up-by-driver': parcel.status === 'PICKED_UP_BY_DRIVER',
                'status-in-transit': parcel.status === 'IN_TRANSIT',
                'status-delivered': parcel.status === 'DELIVERED',
                'status-cancelled': parcel.status === 'CANCELLED'
              }">
          {{ parcel.status | titlecase }}
        </span>
      </div>

      <div class="card-content">
        <p><strong>Sender:</strong> {{ parcel.senderName }}</p>
        <p><strong>Receiver:</strong> {{ parcel.receiverName }}</p>
        <p><strong>From:</strong> {{ parcel.from }}</p>
        <p><strong>To:</strong> {{ parcel.to }}</p>
        <p><strong>Type:</strong> {{ parcel.type }} | <strong>Mode:</strong> {{ parcel.mode }}</p>
        <p><strong>Price:</strong> {{ parcel.price }}</p> <!-- Added -->
      </div>

      <div class="card-actions" *ngIf="!isParcelCompleted(parcel)">
        <div class="location-update" *ngIf="canUpdateLocation(parcel)">
          <div class="location-input-group">
            <input
              type="text"
              class="location-input"
              placeholder="Enter current location (e.g., Westlands, Nairobi)"
              [(ngModel)]="parcel.currentLocationInput"
              (ngModelChange)="parcel.currentLocationInput = $event" />
            <button
              class="btn-update-location"
              [disabled]="!parcel.currentLocationInput"
              (click)="updateLocation(parcel, parcel.currentLocationInput)">
              Update Location
            </button>
          </div>
          <p class="location-help">
            Enter a specific address or area for accurate tracking.
          </p>
        </div>

        <div class="action-buttons">
          <button
            class="btn-pickup"
            *ngIf="canMarkPickedUp(parcel)"
            (click)="markPickedUp(parcel)">
            Mark as Picked Up
          </button>
          <button class="btn btn-info" (click)="openMap(parcel)">
            View Map
          </button>
          <button class="btn btn-secondary" (click)="openInfo(parcel)">
            More Details
          </button>
        </div>
      </div>
    </div>

    <div class="empty-state" *ngIf="filteredParcels.length === 0">
      <span class="empty-icon">ðŸ“¦</span>
      <h3>No Parcels Found</h3>
      <p>Try adjusting your filters or check back later.</p>
    </div>
  </div>
</div>

<div class="modal-overlay" *ngIf="showMapModal || showInfoModal" (click)="closeModals()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h3 *ngIf="showMapModal && selectedParcel">
        Route for Parcel #{{ selectedParcel.trackingId }}
      </h3>
      <h3 *ngIf="showInfoModal && selectedParcel">
        Details for Parcel #{{ selectedParcel.trackingId }}
      </h3>
      <button class="modal-close" (click)="closeModals()">Ã—</button>
    </div>

    <div class="modal-body" *ngIf="showMapModal && selectedParcel">
      <div id="google-map"></div>
    </div>

    <div class="modal-body" *ngIf="showInfoModal && selectedParcel">
      <div class="detail-grid">
        <div class="detail-item">
          <strong>Sender:</strong> {{ selectedParcel.senderName }}
        </div>
        <div class="detail-item">
          <strong>Sender Email:</strong> {{ selectedParcel.senderEmail || 'N/A' }}
        </div>
        <div class="detail-item">
          <strong>Receiver:</strong> {{ selectedParcel.receiverName }}
        </div>
        <div class="detail-item">
          <strong>Receiver Email:</strong> {{ selectedParcel.receiverEmail || 'N/A' }}
        </div>
        <div class="detail-item">
          <strong>From:</strong> {{ selectedParcel.from }}
        </div>
        <div class="detail-item">
          <strong>To:</strong> {{ selectedParcel.to }}
        </div>
        <div class="detail-item">
          <strong>Date Sent:</strong> {{ selectedParcel.dateSent | date:'medium' }}
        </div>
        <div class="detail-item">
          <strong>Status:</strong> {{ selectedParcel.status | titlecase }}
        </div>
        <div class="detail-item">
          <strong>Description:</strong> {{ selectedParcel.description || 'N/A' }}
        </div>
        <div class="detail-item">
          <strong>Type:</strong> {{ selectedParcel.type }}
        </div>
        <div class="detail-item">
          <strong>Weight:</strong> {{ selectedParcel.weight }} kg
        </div>
        <div class="detail-item">
          <strong>Delivery Mode:</strong> {{ selectedParcel.mode }}
        </div>
        <div class="detail-item">
          <strong>Price:</strong> {{ selectedParcel.price }}</div> <!-- Added -->
      </div>
    </div>

    <div class="modal-footer">
      <button class="btn" (click)="closeModals()">Close</button>
    </div>
  </div>
</div>